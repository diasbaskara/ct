// ==UserScript==
// @name         CoreTabs
// @namespace    https://github.com/diasbaskara/ct
// @version      1.0.0
// @description  Enhanced CoreTabs userscript with modular architecture
// @author       diasbaskara
// @match        https://coretax.intranet.pajak.go.id/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=pajak.go.id
// @homepage     https://github.com/diasbaskara/ct
// @supportURL   https://github.com/diasbaskara/ct/issues
// @updateURL    https://cdn.jsdelivr.net/gh/diasbaskara/ct@main/cdn/latest/coretabs.meta.js
// @downloadURL  https://cdn.jsdelivr.net/gh/diasbaskara/ct@main/cdn/latest/coretabs.user.js
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_deleteValue

// ==/UserScript==
(()=>{"use strict";const e=new class{constructor(){this.state={allMyCases:[],allCaseDocuments:[],allCaseUsers:[],refundReviewData:[],filteredRefundData:[],selectedCaseId:null,loadedDocsForCaseId:null,loadedUsersForCaseId:null,loadedProfileForCaseId:null,loadedRoutingForCaseId:null,routingData:null,workflowDiagram:null,currentScreen:"my-cases",currentTab:"my-cases",sidebarOpen:!1},this.listeners={}}get(e){return this.state[e]}set(e,t){const n=this.state[e];this.state[e]=t,this.listeners[e]&&this.listeners[e].forEach(e=>{try{e(t,n)}catch(e){}})}subscribe(e,t){return this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t),()=>{const n=this.listeners[e].indexOf(t);n>-1&&this.listeners[e].splice(n,1)}}getAll(){return{...this.state}}clear(){this.state={allMyCases:[],allCaseDocuments:[],allCaseUsers:[],refundReviewData:[],filteredRefundData:[],selectedCaseId:null,loadedDocsForCaseId:null,loadedUsersForCaseId:null,loadedProfileForCaseId:null,loadedRoutingForCaseId:null,routingData:null,workflowDiagram:null,currentScreen:"my-cases",currentTab:"my-cases",sidebarOpen:!1},this.listeners={}}notify(e,t){this.listeners[e]&&this.listeners[e].forEach(e=>{try{e(t)}catch(e){}})}},t="cats-angular-clientuser:https://coretax.intranet.pajak.go.id/identityprovider:cats-angular-client",n="In Progress",a="coretabs-language",r={CASES:"https://coretax.intranet.pajak.go.id/casemanagement/api/caselist/mycases",DOCUMENTS:"https://coretax.intranet.pajak.go.id/documentmanagement/api/casedocument/list",USERS:"https://coretax.intranet.pajak.go.id/casemanagement/api/caseuser/list",PROFILE:"https://coretax.intranet.pajak.go.id/casemanagement/api/generalinformation/view",ROUTING:"https://coretax.intranet.pajak.go.id/casemanagement/api/caserouting/view",DOWNLOAD:"https://coretax.intranet.pajak.go.id/documentmanagement/api/download"};function o(){const e=localStorage.getItem(t);if(e)try{const t=JSON.parse(e);return t.access_token||t.accessToken}catch(e){return null}return null}function s(e=null){const t=o(),n={"Content-Type":"application/json",Accept:"application/json"};return t&&(n.Authorization=`Bearer ${t}`),e&&(n["X-Case-Url"]=e),n}async function i(){try{const t=await fetch(r.CASES,{method:"POST",headers:s(),body:JSON.stringify({filter:n,pageSize:50,pageNumber:1})});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();return e.set("allMyCases",a.data||a),a}catch(e){throw new Error(`Failed to fetch cases: ${e.message}`)}}const c={my_cases:"My Cases",case_details:"Case Details",back:"← Back",no_case_selected:"No Case Selected",select_case_message:'Please select a case from the "My Cases" screen',select_case_tab_message:'Please select a case from the "My Cases" tab',profile:"Profile",documents:"Documents",users:"Users",refund_review:"Refund Review",case_documents:"Case Documents",case_users:"Case Users",routing:"Routing",open:"Open",docs:"Docs",download:"Download",downloading:"Downloading...",print:"Print",printing:"Printing...",print_failed:"Print failed",reload:"Reload",reload_page:"Reload Page",collapse_all:"Collapse All",expand_all:"Expand All",download_excel:"Download Excel",coretabs:"CoreTabs",filter_by_status:"Filter by Status:",filter_by_role:"Filter by Role:",filter_by_reported:"Filter by Reported:",show_all:"Show All",yes:"Yes",no:"No",case_number:"Case Number",taxpayer_name_tin:"Taxpayer Name & TIN",case_type:"Case Type",status:"Status",created_date:"Created Date",actions:"Actions",letter_number:"Letter Number",file_name:"File Name",date:"Date",full_name:"Full Name",nip:"NIP",position:"Position",office_name:"Office Name",doc_number:"Doc Number",selling_price:"Selling Price",vat_paid:"VAT Paid",stlg_paid:"STLG Paid",trans_code:"Trans Code",reported:"Reported",case_role:"Case Role",in_progress:"In Progress",completed:"Completed",cancelled:"Cancelled",draft:"Draft",submitted:"Submitted",approved:"Approved",rejected:"Rejected",taxpayer:"Taxpayer",tax_officer:"Tax Officer",supervisor:"Supervisor",head_of_regional_office:"Head of Regional Office","head_of_division_of_audit,_collection,_intelligence,_and_investigation":"Head of Division of Audit, Collection, Intelligence, and Investigation","head_of_section_of_preliminary_investigation_&_investigation_administration":"Head of Section of Preliminary Investigation & Investigation Administration",digital_forensic_team_member:"Digital Forensic Team Member",digital_forensic_team_leader:"Digital Forensic Team Leader",loading:"Loading...",loading_my_cases:"Loading my cases...",loading_documents:"Loading documents...",loading_users:"Loading users...",loading_profile:"Loading profile information...",loading_routing:"Loading routing information...",loading_profile_name:"Loading...",loading_profile_email:"Loading...",no_cases_match:"No cases match the selected filter.",no_documents_found:"No documents found or match the selected filter.",no_users_found:"No users found or match the selected filter.",no_refund_data:"No refund review data matches the filter.",profile_not_available:"Profile not available",please_log_in:"Please log in",error_loading_profile:"Error loading profile",please_reload:"Please reload",download_failed:"Download failed",case_must_be_selected:"A case must be selected.",select_case_for_documents:"Please select a case to view its documents.",select_case_for_users:"Please select a case to view its users.",select_case_for_profile:"Please select a case to view its profile information.",select_case_for_routing:"Please select a case to view its routing information.",select_refund_case:'Select a refund case and click "Refund Review" in the header or row.',step_1_3_fetching_subprocess:"Step 1/3: Fetching Sub Process ID...",step_2_3_fetching_reference:"Step 2/3: Fetching reference number...",step_3_3_fetching_refund:"Step 3/3: Fetching refund details...",registration_date:"Registration Date",email_address:"Email Address",telephone_number:"Telephone Number",tax_region:"Tax Region",tax_office:"Tax Office",tax_office_address:"Tax Office Address",tax_office_phone:"Tax Office Phone Number",description:"Description",business_classification:"Business Classification",tax_period:"Tax Period",tax_year:"Tax Year",last_modified:"Last Modified",created_by:"Created By",na:"N/A",error_occurred:"An error occurred:",language:"Language"},d={my_cases:"Kasus Saya",case_details:"Detail Kasus",back:"← Kembali",no_case_selected:"Tidak Ada Kasus Dipilih",select_case_message:'Silakan pilih kasus dari layar "Kasus Saya"',select_case_tab_message:'Silakan pilih kasus dari tab "Kasus Saya"',profile:"Profil",documents:"Dokumen",users:"Pengguna",refund_review:"Tinjauan Restitusi",case_documents:"Dokumen Kasus",case_users:"Pengguna Kasus",routing:"Alur",open:"Buka",docs:"Dokumen",download:"Unduh",downloading:"Mengunduh...",print:"Cetak",printing:"Mencetak...",print_failed:"Cetak gagal",reload:"Muat Ulang",reload_page:"Muat Ulang Halaman",collapse_all:"Tutup Semua",expand_all:"Bentangkan Semua",download_excel:"Unduh Excel",coretabs:"CoreTabs",filter_by_status:"Filter berdasarkan Status:",filter_by_role:"Filter berdasarkan Peran:",filter_by_reported:"Filter berdasarkan Dilaporkan:",show_all:"Tampilkan Semua",yes:"Ya",no:"Tidak",case_number:"Nomor Kasus",taxpayer_name_tin:"Nama & NPWP Wajib Pajak",taxpayer_name:"Nama Wajib Pajak",tin:"NPWP",case_type:"Jenis Kasus",status:"Status",created_date:"Tanggal Dibuat",actions:"Aksi",letter_number:"Nomor Surat",file_name:"Nama File",date:"Tanggal",full_name:"Nama Lengkap",nip:"NIP",position:"Jabatan",office_name:"Nama Kantor",doc_number:"Nomor Dokumen",selling_price:"Harga Jual",vat_paid:"PPN Dibayar",stlg_paid:"PPnBM Dibayar",trans_code:"Kode Transaksi",reported:"Dilaporkan",case_role:"Peran Kasus",in_progress:"Sedang Berlangsung",completed:"Selesai",cancelled:"Dibatalkan",draft:"Draf",submitted:"Diajukan",approved:"Disetujui",rejected:"Ditolak",taxpayer:"Wajib Pajak",tax_officer:"Petugas Pajak",supervisor:"Supervisor",head_of_regional_office:"Kepala Kanwil","head_of_division_of_audit,_collection,_intelligence,_and_investigation":"Kepala Bidang Pemeriksaan, Penagihan, Intelijen, dan Penyidikan","head_of_section_of_preliminary_investigation_&_investigation_administration":"Kepala Seksi Administrasi Bukti Permulaan dan Penyidikan",digital_forensic_team_member:"Anggota Tim Forensik Digital",digital_forensic_team_leader:"Ketua Tim Forensik Digital",loading:"Memuat...",loading_my_cases:"Memuat kasus saya...",loading_documents:"Memuat dokumen...",loading_users:"Memuat pengguna...",loading_profile:"Memuat informasi profil...",loading_routing:"Memuat informasi alur...",loading_profile_name:"Memuat...",loading_profile_email:"Memuat...",no_cases_match:"Tidak ada kasus yang sesuai dengan filter yang dipilih.",no_documents_found:"Tidak ada dokumen ditemukan atau sesuai dengan filter yang dipilih.",no_users_found:"Tidak ada pengguna ditemukan atau sesuai dengan filter yang dipilih.",no_refund_data:"Tidak ada data tinjauan restitusi yang sesuai dengan filter.",profile_not_available:"Profil tidak tersedia",please_log_in:"Silakan masuk",error_loading_profile:"Kesalahan memuat profil",please_reload:"Silakan muat ulang",download_failed:"Unduhan gagal",case_must_be_selected:"Kasus harus dipilih.",select_case_for_documents:"Silakan pilih kasus untuk melihat dokumennya.",select_case_for_users:"Silakan pilih kasus untuk melihat penggunanya.",select_case_for_profile:"Silakan pilih kasus untuk melihat informasi profilnya.",select_case_for_routing:"Silakan pilih kasus untuk melihat informasi alurnya.",select_refund_case:'Pilih kasus restitusi dan klik "Tinjauan Restitusi" di header atau baris.',step_1_3_fetching_subprocess:"Langkah 1/3: Mengambil ID Sub Proses...",step_2_3_fetching_reference:"Langkah 2/3: Mengambil nomor referensi...",step_3_3_fetching_refund:"Langkah 3/3: Mengambil detail restitusi...",registration_date:"Tanggal Registrasi",email_address:"Alamat Email",telephone_number:"Nomor Telepon",tax_region:"Wilayah Pajak",tax_office:"Kantor Pajak",tax_office_address:"Alamat Kantor Pajak",tax_office_phone:"Nomor Telepon Kantor Pajak",description:"Deskripsi",business_classification:"Klasifikasi Usaha",tax_period:"Periode Pajak",tax_year:"Tahun Pajak",last_modified:"Terakhir Diubah",created_by:"Dibuat Oleh",na:"T/A",error_occurred:"Terjadi kesalahan:",language:"Bahasa"},l={en:c,id:d};let p="en";function u(e,t=e){return l[p]?.[e]||t}p=function(){const e=localStorage.getItem(a);return e&&l[e]?e:navigator.language.toLowerCase().startsWith("id")?"id":"en"}();const m=class{constructor(e,t){this.currentVersion=e||"1.0.0",this.cdnBaseUrl=t||"https://cdn.jsdelivr.net/gh/diasbaskara/ct@main/cdn",this.checkInterval=864e5,this.lastCheckKey="coretabs_last_update_check"}async checkForUpdates(e=!1){try{if(!e&&!this.shouldCheck())return null;const t=await this.fetchVersionsData();if(!t)return null;const n=t.latest,a=this.compareVersions(n,this.currentVersion)>0;if("undefined"!=typeof GM_setValue?await GM_setValue(this.lastCheckKey,Date.now()):localStorage.setItem(this.lastCheckKey,Date.now().toString()),a){const e={currentVersion:this.currentVersion,latestVersion:n,releaseNotes:t.versions[n]?.notes||"",downloadUrl:`${this.cdnBaseUrl}/latest/coretabs.user.js`};return this.showUpdateNotification(e),e}return null}catch(e){return null}}async fetchVersionsData(){try{return new Promise(e=>{if("undefined"==typeof GM_xmlhttpRequest)return void e(null);const t=setTimeout(()=>{e(null)},1e4);GM_xmlhttpRequest({method:"GET",url:`${this.cdnBaseUrl}/versions.json`,timeout:1e4,onload:n=>{clearTimeout(t);try{const t=JSON.parse(n.responseText);e(t)}catch(t){e(null)}},onerror:()=>{clearTimeout(t),e(null)},ontimeout:()=>{clearTimeout(t),e(null)}})})}catch(e){return null}}shouldCheck(){try{let e;if("undefined"!=typeof GM_getValue)e=GM_getValue(this.lastCheckKey,0);else{const t=localStorage.getItem(this.lastCheckKey);e=t?parseInt(t):0}if(!e)return!0;return Date.now()-e>this.checkInterval}catch(e){return!0}}compareVersions(e,t){const n=e.split(".").map(Number),a=t.split(".").map(Number);for(let e=0;e<Math.max(n.length,a.length);e++){const t=n[e]||0,r=a[e]||0;if(t>r)return 1;if(t<r)return-1}return 0}showUpdateNotification(e){const t=document.getElementById("coretabs-update-notification");t&&t.remove();const n=document.createElement("div");n.id="coretabs-update-notification",n.className="coretabs-update-notification";const a=document.createElement("div");a.className="update-title",a.textContent=u("update.available"),n.appendChild(a);const r=document.createElement("div");r.className="update-message",r.textContent=`${u("update.newVersion")} ${e}`,n.appendChild(r);const o=document.createElement("div");o.className="update-buttons";const s=document.createElement("button");s.textContent=u("update.install"),s.onclick=function(){window.open(this.updateUrl,"_blank"),n.remove()}.bind(this),o.appendChild(s);const i=document.createElement("button");i.textContent=u("common.close"),i.onclick=function(){n.remove()},o.appendChild(i),n.appendChild(o),document.body.appendChild(n),setTimeout(()=>{n.parentNode&&n.remove()},1e4)}createUpdateNotification(e){const t=document.createElement("div");t.className="coretabs-update-notification",t.style.cssText="\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        background: white;\n        border: 1px solid #ddd;\n        border-radius: 8px;\n        padding: 20px;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n        z-index: 10000;\n        max-width: 400px;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    ";const n=document.createElement("div");n.className="coretabs-update-content";const a=document.createElement("div");a.className="coretabs-update-header";const r=document.createElement("h3");r.textContent=u("update.available","Update Available"),r.style.margin="0 0 10px 0";const o=document.createElement("button");o.className="coretabs-update-close",o.textContent="×",o.style.cssText="float: right; background: none; border: none; font-size: 20px; cursor: pointer;",o.onclick=()=>t.remove(),a.appendChild(r),a.appendChild(o);const s=document.createElement("div");s.className="coretabs-update-body";const i=document.createElement("p");i.textContent=u("update.newVersion","A new version of CoreTabs is available!");const c=document.createElement("p"),d=document.createElement("strong");d.textContent=`${u("update.current","Current")}: ${e.currentVersion}`,c.appendChild(d);const l=document.createElement("p"),p=document.createElement("strong");if(p.textContent=`${u("update.latest","Latest")}: ${e.latestVersion}`,l.appendChild(p),s.appendChild(i),s.appendChild(c),s.appendChild(l),e.changelog.length>0){const t=document.createElement("div");t.className="coretabs-update-changelog";const n=document.createElement("h4");n.textContent=u("update.changelog","What's New:"),t.appendChild(n);const a=document.createElement("ul");e.changelog.forEach(e=>{const t=document.createElement("li");t.textContent=e,a.appendChild(t)}),t.appendChild(a),s.appendChild(t)}const m=document.createElement("div");m.className="coretabs-update-actions",m.style.cssText="margin-top: 15px; text-align: right;";const h=document.createElement("a");h.href=e.downloadUrl,h.className="coretabs-update-btn coretabs-update-btn-primary",h.textContent=u("update.install","Install Update"),h.style.cssText="display: inline-block; padding: 8px 16px; margin: 0 5px; background: #007cba; color: white; text-decoration: none; border-radius: 4px;";const g=document.createElement("button");g.className="coretabs-update-btn coretabs-update-btn-secondary",g.textContent=u("update.later","Later"),g.style.cssText="padding: 8px 16px; margin: 0 5px; background: #f0f0f0; border: 1px solid #ccc; border-radius: 4px; cursor: pointer;",g.onclick=()=>t.remove();const b=document.createElement("button");return b.className="coretabs-update-btn coretabs-update-btn-text",b.textContent=u("update.skip","Skip This Version"),b.style.cssText="padding: 8px 16px; margin: 0 5px; background: none; border: none; color: #666; cursor: pointer;",b.onclick=()=>{localStorage.setItem("coretabs_skip_version",e.latestVersion),t.remove()},m.appendChild(h),m.appendChild(g),m.appendChild(b),n.appendChild(a),n.appendChild(s),n.appendChild(m),t.appendChild(n),this.injectUpdateStyles(),t}injectUpdateStyles(){if(document.querySelector("#coretabs-update-styles"))return;const e=document.createElement("style");e.id="coretabs-update-styles",e.textContent="\n        .coretabs-update-notification {\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            width: 350px;\n            background: white;\n            border: 1px solid #ddd;\n            border-radius: 8px;\n            box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n            z-index: 10000;\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            font-size: 14px;\n            animation: slideInRight 0.3s ease-out;\n        }\n        \n        @keyframes slideInRight {\n            from { transform: translateX(100%); opacity: 0; }\n            to { transform: translateX(0); opacity: 1; }\n        }\n        \n        .coretabs-update-content {\n            padding: 0;\n        }\n        \n        .coretabs-update-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 15px 20px 10px;\n            border-bottom: 1px solid #eee;\n        }\n        \n        .coretabs-update-header h3 {\n            margin: 0;\n            color: #333;\n            font-size: 16px;\n            font-weight: 600;\n        }\n        \n        .coretabs-update-close {\n            background: none;\n            border: none;\n            font-size: 20px;\n            cursor: pointer;\n            color: #999;\n            padding: 0;\n            width: 24px;\n            height: 24px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n        \n        .coretabs-update-close:hover {\n            color: #666;\n        }\n        \n        .coretabs-update-body {\n            padding: 15px 20px;\n        }\n        \n        .coretabs-update-body p {\n            margin: 0 0 8px 0;\n            color: #555;\n            line-height: 1.4;\n        }\n        \n        .coretabs-update-changelog {\n            margin-top: 12px;\n            padding-top: 12px;\n            border-top: 1px solid #f0f0f0;\n        }\n        \n        .coretabs-update-changelog h4 {\n            margin: 0 0 8px 0;\n            font-size: 14px;\n            color: #333;\n        }\n        \n        .coretabs-update-changelog ul {\n            margin: 0;\n            padding-left: 18px;\n        }\n        \n        .coretabs-update-changelog li {\n            margin-bottom: 4px;\n            color: #666;\n            font-size: 13px;\n        }\n        \n        .coretabs-update-actions {\n            padding: 15px 20px;\n            border-top: 1px solid #eee;\n            display: flex;\n            gap: 8px;\n            flex-wrap: wrap;\n        }\n        \n        .coretabs-update-btn {\n            padding: 8px 16px;\n            border-radius: 4px;\n            text-decoration: none;\n            font-size: 13px;\n            font-weight: 500;\n            cursor: pointer;\n            border: 1px solid transparent;\n            transition: all 0.2s;\n        }\n        \n        .coretabs-update-btn-primary {\n            background: #007cba;\n            color: white;\n        }\n        \n        .coretabs-update-btn-primary:hover {\n            background: #005a87;\n        }\n        \n        .coretabs-update-btn-secondary {\n            background: #f8f9fa;\n            color: #495057;\n            border-color: #dee2e6;\n        }\n        \n        .coretabs-update-btn-secondary:hover {\n            background: #e9ecef;\n        }\n        \n        .coretabs-update-btn-text {\n            background: none;\n            color: #6c757d;\n            padding: 8px 12px;\n        }\n        \n        .coretabs-update-btn-text:hover {\n            color: #495057;\n            background: #f8f9fa;\n        }\n    ",document.head.appendChild(e)}async manualCheck(){return await this.checkForUpdates(!0)}};function h(t,n){if(!n){const e=document.createElement("div");return e.className="ct-no-selection",e.textContent=u("profile.no_case_selected"),void t.appendChild(e)}const a=document.createElement("div");a.className="ct-loading",a.textContent=u("common.loading"),t.appendChild(a),async function(t){try{const n=await fetch(r.PROFILE,{method:"POST",headers:s(t),body:JSON.stringify({caseId:t})});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const a=await n.json();return e.set("loadedProfileForCaseId",t),a}catch(e){throw new Error(`Failed to fetch profile: ${e.message}`)}}(n).then(e=>{if(t.innerHTML="",!e||!e.data){const e=document.createElement("div");return e.className="ct-no-data",e.textContent=u("profile.no_data"),void t.appendChild(e)}const n=e.data,a=document.createElement("div");a.className="ct-profile-container";const r=g(u("profile.basic_info"),[{label:u("profile.case_number"),value:n.caseNumber},{label:u("profile.status"),value:n.status},{label:u("profile.type"),value:n.caseType},{label:u("profile.priority"),value:n.priority},{label:u("profile.created_date"),value:n.createdDate},{label:u("profile.last_update"),value:n.lastUpdate}]),o=g(u("profile.customer_info"),[{label:u("profile.customer_name"),value:n.customerName},{label:u("profile.customer_email"),value:n.customerEmail},{label:u("profile.customer_phone"),value:n.customerPhone},{label:u("profile.customer_id"),value:n.customerId}]),s=g(u("profile.transaction_info"),[{label:u("profile.transaction_id"),value:n.transactionId},{label:u("profile.amount"),value:n.amount},{label:u("profile.currency"),value:n.currency},{label:u("profile.payment_method"),value:n.paymentMethod},{label:u("profile.transaction_date"),value:n.transactionDate}]);a.appendChild(r),a.appendChild(o),a.appendChild(s),t.appendChild(a)}).catch(()=>{t.innerHTML="";const e=document.createElement("div");e.className="ct-error",e.textContent=u("common.error"),t.appendChild(e)})}function g(e,t){const n=document.createElement("div");n.className="ct-profile-section";const a=document.createElement("h4");a.className="ct-profile-section-title",a.textContent=e,n.appendChild(a);const r=document.createElement("div");return r.className="ct-profile-fields",t.forEach(e=>{if(e.value){const t=document.createElement("div");t.className="ct-profile-field";const n=document.createElement("span");n.className="ct-profile-label",n.textContent=e.label+":";const a=document.createElement("span");a.className="ct-profile-value",a.textContent=e.value,t.appendChild(n),t.appendChild(a),r.appendChild(t)}}),n.appendChild(r),n}function b(t,n){if(!n){const e=document.createElement("div");return e.className="ct-no-selection",e.textContent=u("documents.no_case_selected"),void t.appendChild(e)}const a=document.createElement("div");a.className="ct-loading",a.textContent=u("common.loading"),t.appendChild(a),async function(t){try{const n=await fetch(r.DOCUMENTS,{method:"POST",headers:s(t),body:JSON.stringify({caseId:t})});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const a=await n.json();return e.set("allCaseDocuments",a.data||a),e.set("loadedDocsForCaseId",t),a}catch(e){throw new Error(`Failed to fetch documents: ${e.message}`)}}(n).then(e=>{if(t.innerHTML="",!e||!e.data||0===e.data.length){const e=document.createElement("div");return e.className="ct-no-data",e.textContent=u("documents.no_data"),void t.appendChild(e)}const n=document.createElement("table");n.className="ct-table";const a=document.createElement("thead"),o=document.createElement("tr");[u("documents.name"),u("documents.type"),u("documents.size"),u("documents.date"),u("documents.actions")].forEach(e=>{const t=document.createElement("th");t.textContent=e,o.appendChild(t)}),a.appendChild(o),n.appendChild(a);const i=document.createElement("tbody");e.data.forEach(e=>{const t=document.createElement("tr"),n=document.createElement("td");n.textContent=e.name||"N/A",t.appendChild(n);const a=document.createElement("td");a.textContent=e.type||"N/A",t.appendChild(a);const o=document.createElement("td");o.textContent=function(e){if(!e)return"N/A";const t=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,n)*100)/100+" "+t[n]}(e.size),t.appendChild(o);const c=document.createElement("td");c.textContent=e.date?new Date(e.date).toLocaleDateString():"N/A",t.appendChild(c);const d=document.createElement("td"),l=document.createElement("div");l.className="ct-actions";const p=document.createElement("button");p.className="ct-btn ct-btn-sm ct-btn-primary",p.textContent=u("documents.download"),p.onclick=()=>async function(e,t){try{const n=await fetch(`${r.DOWNLOAD}/${e}`,{method:"GET",headers:s()});if(!n.ok)throw new Error(`Download failed: ${n.status}`);const a=await n.blob(),o=window.URL.createObjectURL(a),i=document.createElement("a");return i.href=o,i.download=t||"document",document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(o),!0}catch(e){throw new Error(`Failed to download document: ${e.message}`)}}(e.id,e.name);const m=document.createElement("button");m.className="ct-btn ct-btn-sm ct-btn-secondary",m.textContent=u("documents.print"),m.onclick=()=>async function(e){try{const t=await fetch(`${r.DOWNLOAD}/${e}`,{method:"GET",headers:s()});if(!t.ok)throw new Error(`Print failed: ${t.status}`);const n=await t.blob(),a=window.URL.createObjectURL(n),o=window.open(a,"_blank");return o&&(o.onload=()=>{o.print()}),!0}catch(e){throw new Error(`Failed to print document: ${e.message}`)}}(e.id),l.appendChild(p),l.appendChild(m),d.appendChild(l),t.appendChild(d),i.appendChild(t)}),n.appendChild(i),t.appendChild(n)}).catch(()=>{t.innerHTML="";const e=document.createElement("div");e.className="ct-error",e.textContent=u("common.error"),t.appendChild(e)})}function f(t,n){if(!n){const e=document.createElement("div");return e.className="ct-no-selection",e.textContent=u("users.no_case_selected"),void t.appendChild(e)}const a=document.createElement("div");a.className="ct-loading",a.textContent=u("common.loading"),t.appendChild(a),async function(t){try{const n=await fetch(r.USERS,{method:"POST",headers:s(t),body:JSON.stringify({caseId:t})});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const a=await n.json();return e.set("allCaseUsers",a.data||a),e.set("loadedUsersForCaseId",t),a}catch(e){throw new Error(`Failed to fetch users: ${e.message}`)}}(n).then(e=>{if(t.innerHTML="",!e||!e.data||0===e.data.length){const e=document.createElement("div");return e.className="ct-no-data",e.textContent=u("users.no_data"),void t.appendChild(e)}const n=document.createElement("table");n.className="ct-table ct-users-table";const a=document.createElement("thead"),r=document.createElement("tr");[u("users.name"),u("users.role"),u("users.email"),u("users.department"),u("users.last_activity")].forEach(e=>{const t=document.createElement("th");t.textContent=e,r.appendChild(t)}),a.appendChild(r),n.appendChild(a);const o=document.createElement("tbody");e.data.forEach(e=>{const t=document.createElement("tr"),n=document.createElement("td");n.textContent=e.name||"N/A",t.appendChild(n);const a=document.createElement("td"),r=document.createElement("span");r.className=`ct-badge ct-role-${(e.role||"").toLowerCase().replace(" ","-")}`,r.textContent=e.role||"N/A",a.appendChild(r),t.appendChild(a);const s=document.createElement("td");s.textContent=e.email||"N/A",t.appendChild(s);const i=document.createElement("td");i.textContent=e.department||"N/A",t.appendChild(i);const c=document.createElement("td");c.textContent=e.lastActivity||"N/A",t.appendChild(c),o.appendChild(t)}),n.appendChild(o),t.appendChild(n)}).catch(()=>{t.innerHTML="";const e=document.createElement("div");e.className="ct-error",e.textContent=u("common.error"),t.appendChild(e)})}const x="en-US",v=Intl.DateTimeFormat().resolvedOptions().timeZone;function C(e,t="short",n={}){if(!e)return n.fallback||"N/A";try{const a=new Date(e);if(isNaN(a.getTime()))return n.fallback||"Invalid Date";const r=n.locale||x,o=n.timezone||v;switch(t){case"short":default:return y(a,r,o);case"long":return w(a,r,o);case"iso":return a.toISOString();case"custom":return k(a,n.pattern||"dd/MM/yyyy");case"relative":return N(a,r);case"time":return E(a,r,o);case"datetime":return _(a,r,o)}}catch(t){return n.fallback||e.toString()}}function y(e,t=x,n=v){return new Intl.DateTimeFormat(t,{day:"2-digit",month:"2-digit",year:"numeric",timeZone:n}).format(e)}function w(e,t=x,n=v){return new Intl.DateTimeFormat(t,{year:"numeric",month:"long",day:"numeric",timeZone:n}).format(e)}function _(e,t=x,n=v){return new Intl.DateTimeFormat(t,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",timeZone:n}).format(e)}function E(e,t=x,n=v){return new Intl.DateTimeFormat(t,{hour:"2-digit",minute:"2-digit",timeZone:n}).format(e)}function k(e,t="dd/MM/yyyy"){const n=e.getDate().toString().padStart(2,"0"),a=(e.getMonth()+1).toString().padStart(2,"0"),r=e.getFullYear(),o=e.getHours().toString().padStart(2,"0"),s=e.getMinutes().toString().padStart(2,"0"),i=e.getSeconds().toString().padStart(2,"0");return t.replace(/yyyy/g,r).replace(/yy/g,r.toString().slice(-2)).replace(/MM/g,a).replace(/dd/g,n).replace(/HH/g,o).replace(/mm/g,s).replace(/ss/g,i)}function N(e,t=x){try{const n=(new Date).getTime()-e.getTime(),a=Math.floor(n/1e3),r=Math.floor(a/60),o=Math.floor(r/60),s=Math.floor(o/24);return a<60?"just now":r<60?`${r} minute${1!==r?"s":""} ago`:o<24?`${o} hour${1!==o?"s":""} ago`:s<7?`${s} day${1!==s?"s":""} ago`:y(e,t)}catch(t){return e.toString()}}function S(){return new Promise((e,t)=>{if("undefined"!=typeof XLSX)return void e(XLSX);const n=document.createElement("script");n.src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js",n.onload=()=>e(window.XLSX),n.onerror=t,document.head.appendChild(n)})}async function T(e,t="export",n={}){try{const a=await S(),r=a.utils.book_new(),o=a.utils.json_to_sheet(e);return a.utils.book_append_sheet(r,o,n.sheetName||"Data"),a.writeFile(r,`${t}.xlsx`),!0}catch(e){throw new Error(`Export failed: ${e.message}`)}}function D(e){return e.map(e=>({"Route ID":e.id||"",From:e.from||"",To:e.to||"",Status:A(e.status),Created:C(e.created,"short")}))}function I(e,t="USD"){return e?new Intl.NumberFormat("en-US",{style:"currency",currency:t}).format(e):""}function A(e){return e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():""}function L(t,n){if(!n){const e=document.createElement("div");return e.className="ct-no-selection",e.textContent=u("refund.no_case_selected"),void t.appendChild(e)}const a=document.createElement("div");a.className="ct-loading",a.textContent=u("common.loading"),t.appendChild(a),async function(t){try{const n=await fetch("https://coretax.intranet.pajak.go.id/casemanagement/api/casedetail/view",{method:"POST",headers:s(),body:JSON.stringify({caseId:t})});if(!n.ok)throw new Error(`Failed to fetch subprocess: ${n.status}`);const a=await n.json(),r=a.data?.subProcessId;if(!r)throw new Error("SubProcess ID not found");const o=await fetch("https://coretax.intranet.pajak.go.id/casemanagement/api/casereference/view",{method:"POST",headers:s(),body:JSON.stringify({subProcessId:r})});if(!o.ok)throw new Error(`Failed to fetch reference: ${o.status}`);const i=await o.json(),c=i.data?.referenceNumber;if(!c)throw new Error("Reference number not found");const d=await fetch("https://coretax.intranet.pajak.go.id/refundreview/api/refundreview/list",{method:"POST",headers:s(),body:JSON.stringify({referenceNumber:c})});if(!d.ok)throw new Error(`Failed to fetch refund details: ${d.status}`);const l=await d.json();return e.set("refundReviewData",l.data||[]),e.set("filteredRefundData",l.data||[]),l}catch(e){throw new Error(`Failed to fetch refund review: ${e.message}`)}}(n).then(e=>{if(t.innerHTML="",!e||!e.data||0===e.data.length){const e=document.createElement("div");return e.className="ct-no-data",e.textContent=u("refund.no_data"),void t.appendChild(e)}const n=document.createElement("div");n.className="ct-controls";const a=document.createElement("div");a.className="ct-filter-container";const r=document.createElement("select");r.className="ct-select",r.innerHTML=`\n      <option value="">${u("refund.all_statuses")}</option>\n      <option value="pending">${u("refund.pending")}</option>\n      <option value="approved">${u("refund.approved")}</option>\n      <option value="rejected">${u("refund.rejected")}</option>\n    `;const o=document.createElement("input");o.type="number",o.className="ct-input",o.placeholder=u("refund.min_amount"),a.appendChild(r),a.appendChild(o);const s=document.createElement("button");s.className="ct-btn ct-btn-primary",s.textContent=u("refund.export_excel"),s.onclick=()=>function(e){try{const t=function(e){return e.map(e=>({"Case ID":e.caseId||"",Amount:I(e.amount,e.currency),Status:A(e.status),Date:C(e.date,"short"),Reason:e.reason||"","Processed By":e.processedBy||""}))}(e);T(t,"refund_review_data")}catch(e){}}(e.data),n.appendChild(a),n.appendChild(s),t.appendChild(n);const i=document.createElement("table");i.className="ct-table";const c=document.createElement("thead"),d=document.createElement("tr");[u("refund.id"),u("refund.amount"),u("refund.currency"),u("refund.status"),u("refund.date"),u("refund.reason"),u("refund.actions")].forEach(e=>{const t=document.createElement("th");t.textContent=e,d.appendChild(t)}),c.appendChild(d),i.appendChild(c);const l=document.createElement("tbody");$(e.data,l),i.appendChild(l),t.appendChild(i),r.addEventListener("change",()=>{const t=e.data;l.innerHTML="",$(t,l)}),o.addEventListener("input",()=>{const t=e.data;l.innerHTML="",$(t,l)})}).catch(()=>{t.innerHTML="";const e=document.createElement("div");e.className="ct-error",e.textContent=u("common.error"),t.appendChild(e)})}function $(e,t){e.forEach(e=>{const n=document.createElement("tr"),a=document.createElement("td");a.textContent=e.id||"N/A",n.appendChild(a);const r=document.createElement("td");var o,s;r.textContent=(o=e.amount,s=e.currency,o?new Intl.NumberFormat("en-US",{style:"currency",currency:s||"USD"}).format(o):"N/A"),n.appendChild(r);const i=document.createElement("td");i.textContent=e.currency||"USD",n.appendChild(i);const c=document.createElement("td"),d=document.createElement("span");d.className=`ct-badge ct-badge-${e.status||"pending"}`,d.textContent=u(`refund.${e.status||"pending"}`),c.appendChild(d),n.appendChild(c);const l=document.createElement("td");l.textContent=e.date?new Date(e.date).toLocaleDateString():"N/A",n.appendChild(l);const p=document.createElement("td");p.textContent=e.reason||"N/A",p.title=e.reason||"",n.appendChild(p);const m=document.createElement("td"),h=document.createElement("div");if(h.className="ct-actions","pending"===e.status){const t=document.createElement("button");t.className="ct-btn ct-btn-sm ct-btn-success",t.textContent=u("refund.approve"),t.onclick=()=>{e.id};const n=document.createElement("button");n.className="ct-btn ct-btn-sm ct-btn-danger",n.textContent=u("refund.reject"),n.onclick=()=>{e.id},h.appendChild(t),h.appendChild(n)}const g=document.createElement("button");g.className="ct-btn ct-btn-sm ct-btn-secondary",g.textContent=u("refund.view_details"),g.onclick=()=>{e.id},h.appendChild(g),m.appendChild(h),n.appendChild(m),t.appendChild(n)})}class P{constructor(e,t={}){this.container=e,this.options={width:t.width||800,height:t.height||400,nodeWidth:t.nodeWidth||120,nodeHeight:t.nodeHeight||60,spacing:t.spacing||150,...t},this.svg=null,this.nodes=[],this.connections=[]}createSVG(){this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("width",this.options.width),this.svg.setAttribute("height",this.options.height),this.svg.setAttribute("viewBox",`0 0 ${this.options.width} ${this.options.height}`),this.svg.className="ct-workflow-diagram";const e=document.createElementNS("http://www.w3.org/2000/svg","style");e.textContent="\n      .ct-workflow-node {\n        cursor: pointer;\n        transition: all 0.3s ease;\n      }\n      .ct-workflow-node:hover {\n        filter: brightness(1.1);\n      }\n      .ct-workflow-node.completed {\n        fill: #28a745;\n        stroke: #1e7e34;\n      }\n      .ct-workflow-node.current {\n        fill: #007bff;\n        stroke: #0056b3;\n        stroke-width: 3;\n      }\n      .ct-workflow-node.pending {\n        fill: #6c757d;\n        stroke: #495057;\n      }\n      .ct-workflow-node.error {\n        fill: #dc3545;\n        stroke: #c82333;\n      }\n      .ct-workflow-text {\n        fill: white;\n        font-family: Arial, sans-serif;\n        font-size: 12px;\n        text-anchor: middle;\n        dominant-baseline: middle;\n        pointer-events: none;\n      }\n      .ct-workflow-connection {\n        stroke: #6c757d;\n        stroke-width: 2;\n        fill: none;\n        marker-end: url(#arrowhead);\n      }\n      .ct-workflow-connection.active {\n        stroke: #007bff;\n        stroke-width: 3;\n      }\n    ",this.svg.appendChild(e);const t=document.createElementNS("http://www.w3.org/2000/svg","defs"),n=document.createElementNS("http://www.w3.org/2000/svg","marker");n.setAttribute("id","arrowhead"),n.setAttribute("markerWidth","10"),n.setAttribute("markerHeight","7"),n.setAttribute("refX","9"),n.setAttribute("refY","3.5"),n.setAttribute("orient","auto");const a=document.createElementNS("http://www.w3.org/2000/svg","polygon");a.setAttribute("points","0 0, 10 3.5, 0 7"),a.setAttribute("fill","#6c757d"),n.appendChild(a),t.appendChild(n),this.svg.appendChild(t),this.container.appendChild(this.svg)}calculateLayout(e){const t=[],n=Math.ceil(Math.sqrt(e.length)),a=Math.ceil(e.length/n),r=(this.options.width-(n-1)*this.options.spacing)/2,o=(this.options.height-(a-1)*this.options.spacing)/2;return e.forEach((e,a)=>{const s=a%n,i=Math.floor(a/n);t.push({x:r+s*this.options.spacing,y:o+i*this.options.spacing,step:e})}),t}createNode(e,t){const n=document.createElementNS("http://www.w3.org/2000/svg","g");n.setAttribute("data-step-index",t);const a=document.createElementNS("http://www.w3.org/2000/svg","rect");a.setAttribute("x",e.x-this.options.nodeWidth/2),a.setAttribute("y",e.y-this.options.nodeHeight/2),a.setAttribute("width",this.options.nodeWidth),a.setAttribute("height",this.options.nodeHeight),a.setAttribute("rx","8"),a.setAttribute("ry","8");let r="pending";e.step.completed?r="completed":e.step.current?r="current":e.step.error&&(r="error"),a.className=`ct-workflow-node ${r}`;const o=document.createElementNS("http://www.w3.org/2000/svg","text");o.setAttribute("x",e.x),o.setAttribute("y",e.y-5),o.className="ct-workflow-text",o.textContent=e.step.title||`Step ${t+1}`;const s=document.createElementNS("http://www.w3.org/2000/svg","text");if(s.setAttribute("x",e.x),s.setAttribute("y",e.y+10),s.className="ct-workflow-text",s.style.fontSize="10px",s.textContent=`#${t+1}`,n.appendChild(a),n.appendChild(o),n.appendChild(s),n.addEventListener("click",()=>{this.onNodeClick(e.step,t)}),e.step.description){const t=document.createElementNS("http://www.w3.org/2000/svg","title");t.textContent=e.step.description,n.appendChild(t)}return n}createConnection(e,t,n=!1){const a=document.createElementNS("http://www.w3.org/2000/svg","path"),r=t.x-e.x,o=t.y-e.y,s=Math.sqrt(r*r+o*o),i=e.x+r/s*(this.options.nodeWidth/2),c=e.y+o/s*(this.options.nodeHeight/2),d=t.x-r/s*(this.options.nodeWidth/2),l=t.y-o/s*(this.options.nodeHeight/2),p=`M ${i} ${c} Q ${(i+d)/2} ${(c+l)/2-Math.min(50,s/4)} ${d} ${l}`;return a.setAttribute("d",p),a.className="ct-workflow-connection "+(n?"active":""),a}render(e){this.svg||this.createSVG();if(this.svg.querySelectorAll(".ct-workflow-node, .ct-workflow-connection").forEach(e=>e.remove()),!e||!e.steps||0===e.steps.length){const e=document.createElementNS("http://www.w3.org/2000/svg","text");return e.setAttribute("x",this.options.width/2),e.setAttribute("y",this.options.height/2),e.className="ct-workflow-text",e.style.fill="#6c757d",e.textContent="No workflow data available",void this.svg.appendChild(e)}const t=this.calculateLayout(e.steps);for(let e=0;e<t.length-1;e++){const n=t[e].step.completed&&!t[e+1].step.completed,a=this.createConnection(t[e],t[e+1],n);this.svg.appendChild(a)}t.forEach((e,t)=>{const n=this.createNode(e,t);this.svg.appendChild(n)})}onNodeClick(e,t){this.options.onNodeClick&&this.options.onNodeClick(e,t)}updateStatus(e,t){const n=this.svg.querySelector(`[data-step-index="${e}"] .ct-workflow-node`);n&&(n.className=`ct-workflow-node ${t}`)}highlightPath(e){this.svg.querySelectorAll(".ct-workflow-connection").forEach((t,n)=>{n<e?t.classList.add("active"):t.classList.remove("active")})}exportSVG(){return(new XMLSerializer).serializeToString(this.svg)}destroy(){this.svg&&this.svg.parentNode&&this.svg.parentNode.removeChild(this.svg)}}function M(t,n){if(!n){const e=document.createElement("div");return e.className="ct-no-selection",e.textContent=u("routing.no_case_selected"),void t.appendChild(e)}const a=document.createElement("div");a.className="ct-loading",a.textContent=u("common.loading"),t.appendChild(a),async function(t){try{const n=await fetch(r.ROUTING,{method:"POST",headers:s(t),body:JSON.stringify({caseId:t})});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const a=await n.json();return e.set("routingData",a.data||a),e.set("loadedRoutingForCaseId",t),a}catch(e){throw new Error(`Failed to fetch routing: ${e.message}`)}}(n).then(e=>{if(t.innerHTML="",!e||!e.data){const e=document.createElement("div");return e.className="ct-no-data",e.textContent=u("routing.no_data"),void t.appendChild(e)}const n=e.data,a=document.createElement("div");a.className="ct-routing-container";const r=document.createElement("div");r.className="ct-routing-controls";const o=document.createElement("div");o.className="ct-view-toggle";const s=document.createElement("button");s.className="ct-btn ct-btn-primary active",s.textContent=u("routing.diagram_view"),s.onclick=()=>L("diagram");const i=document.createElement("button");i.className="ct-btn ct-btn-secondary",i.textContent=u("routing.timeline_view"),i.onclick=()=>L("timeline");const c=document.createElement("button");c.className="ct-btn ct-btn-secondary",c.textContent=u("routing.table_view"),c.onclick=()=>L("table");const d=document.createElement("button");d.className="ct-btn ct-btn-outline",d.textContent=u("routing.export_excel"),d.onclick=()=>function(e){const t=e.details||e.timeline||[],n={formatFunction:D,sheetName:"Routing Details",title:"Case Routing Data Export",subject:"CoreTabs Routing Export"};T(t,`routing-data-${(new Date).toISOString().split("T")[0]}.xlsx`,n).then(e=>{if(!e.success)throw new Error(e.error);{const e=document.createElement("div");e.className="ct-success-message",e.textContent=u("routing.export_success"),document.body.appendChild(e),setTimeout(()=>e.remove(),3e3)}}).catch(e=>{const t=document.createElement("div");t.className="ct-error-message",t.textContent=u("routing.export_error")+": "+e.message,document.body.appendChild(t),setTimeout(()=>t.remove(),5e3)})}(n),o.appendChild(s),o.appendChild(i),o.appendChild(c),r.appendChild(o),r.appendChild(d);const l=document.createElement("div");l.className="ct-routing-current-status";const p=document.createElement("h4");p.textContent=u("routing.current_status");const m=document.createElement("div");m.className="ct-status-info";const h=document.createElement("div");h.className=`ct-status-badge ct-status-${(n.currentStatus||"").toLowerCase().replace(" ","-")}`,h.textContent=n.currentStatus||"N/A";const g=document.createElement("p");g.textContent=n.statusDescription||"";const b=document.createElement("div");b.className="ct-progress-container";const f=document.createElement("span");f.className="ct-progress-label";const x=n.timeline?n.timeline.filter(e=>e.completed).length:0,v=n.timeline?n.timeline.length:0;f.textContent=`${x}/${v} ${u("routing.steps_completed")}`;const C=document.createElement("div");C.className="ct-progress-bar";const y=document.createElement("div");y.className="ct-progress-fill";const w=v>0?x/v*100:0;y.style.width=`${w}%`,C.appendChild(y),b.appendChild(f),b.appendChild(C),m.appendChild(h),m.appendChild(g),m.appendChild(b),l.appendChild(p),l.appendChild(m);const _=document.createElement("div");_.className="ct-routing-content";const E=document.createElement("div");E.className="ct-routing-view ct-diagram-view active",E.id="diagram-view";const k=document.createElement("h4");k.textContent=u("routing.workflow_diagram"),E.appendChild(k);const N=document.createElement("div");N.className="ct-workflow-diagram-container",E.appendChild(N);const S=function(e){if(!e||!e.timeline)return null;const t=e.timeline.map((e,t)=>({id:e.id||t,title:e.title||`Step ${t+1}`,description:e.description||"",completed:e.completed||!1,current:e.current||!1,error:e.error||!1,assignedTo:e.assignedTo||"",department:e.department||"",startDate:e.startDate||e.date,endDate:e.endDate,duration:e.duration||"",notes:e.notes||""}));return{id:e.id,name:e.name||"Case Routing Workflow",description:e.description||"",steps:t,currentStep:t.findIndex(e=>e.current),totalSteps:t.length,completedSteps:t.filter(e=>e.completed).length}}(n);if(S){const e=new P(N,{width:800,height:400,onNodeClick:(e,t)=>{!function(e,t){const n=document.createElement("div");n.className="ct-modal ct-step-details-modal";const a=document.createElement("div");a.className="ct-modal-content";const r=document.createElement("div");r.className="ct-modal-header";const o=document.createElement("h3");o.textContent=`${e.title||`Step ${t+1}`} - ${u("routing.step_details")}`;const s=document.createElement("button");s.className="ct-modal-close",s.innerHTML="&times;",s.onclick=()=>n.remove(),r.appendChild(o),r.appendChild(s);const i=document.createElement("div");i.className="ct-modal-body";const c=`\n        <div class="ct-step-detail-item">\n          <label>${u("routing.step_title")}:</label>\n          <span>${e.title||"N/A"}</span>\n        </div>\n        <div class="ct-step-detail-item">\n          <label>${u("routing.description")}:</label>\n          <span>${e.description||"N/A"}</span>\n        </div>\n        <div class="ct-step-detail-item">\n          <label>${u("routing.assigned_to")}:</label>\n          <span>${e.assignedTo||"N/A"}</span>\n        </div>\n        <div class="ct-step-detail-item">\n          <label>${u("routing.department")}:</label>\n          <span>${e.department||"N/A"}</span>\n        </div>\n        <div class="ct-step-detail-item">\n          <label>${u("routing.status")}:</label>\n          <span class="ct-badge ct-status-${e.completed?"completed":e.current?"current":"pending"}">\n            ${e.completed?u("routing.completed"):e.current?u("routing.current"):u("routing.pending")}\n          </span>\n        </div>\n        <div class="ct-step-detail-item">\n          <label>${u("routing.start_date")}:</label>\n          <span>${e.startDate||"N/A"}</span>\n        </div>\n        <div class="ct-step-detail-item">\n          <label>${u("routing.end_date")}:</label>\n          <span>${e.endDate||"N/A"}</span>\n        </div>\n        <div class="ct-step-detail-item">\n          <label>${u("routing.duration")}:</label>\n          <span>${e.duration||"N/A"}</span>\n        </div>\n        <div class="ct-step-detail-item">\n          <label>${u("routing.notes")}:</label>\n          <span>${e.notes||"N/A"}</span>\n        </div>\n      `;i.innerHTML=c,a.appendChild(r),a.appendChild(i),n.appendChild(a),n.onclick=e=>{e.target===n&&n.remove()},document.body.appendChild(n)}(e,t)}});e.render(S),E.workflowDiagram=e}const I=function(e){const t=document.createElement("div");t.className="ct-routing-view ct-timeline-view",t.id="timeline-view";const n=document.createElement("h4");if(n.textContent=u("routing.workflow_timeline"),t.appendChild(n),e.timeline&&e.timeline.length>0){const n=document.createElement("div");n.className="ct-timeline-list",e.timeline.forEach((e,t)=>{const a=document.createElement("div");a.className=`ct-timeline-item ${e.completed?"completed":""} ${e.current?"current":""}`;const r=document.createElement("div");r.className="ct-timeline-marker";const o=document.createElement("div");o.className="ct-timeline-content";const s=document.createElement("h5");s.textContent=e.title||`Step ${t+1}`;const i=document.createElement("p");i.textContent=e.description||"";const c=document.createElement("div");if(c.className="ct-timeline-meta",e.date){const t=document.createElement("span");t.className="ct-timeline-date",t.textContent=e.date,c.appendChild(t)}if(e.user){const t=document.createElement("span");t.className="ct-timeline-user",t.textContent=`by ${e.user}`,c.appendChild(t)}o.appendChild(s),o.appendChild(i),o.appendChild(c),a.appendChild(r),a.appendChild(o),n.appendChild(a)}),t.appendChild(n)}else{const e=document.createElement("p");e.textContent=u("routing.no_timeline_data"),t.appendChild(e)}return t}(n),A=function(e){const t=document.createElement("div");t.className="ct-routing-view ct-table-view",t.id="table-view";const n=document.createElement("h4");if(n.textContent=u("routing.routing_details"),t.appendChild(n),e.details&&e.details.length>0){const n=document.createElement("div");n.className="ct-table-container";const a=document.createElement("table");a.className="ct-table ct-routing-details-table";const r=document.createElement("thead"),o=document.createElement("tr");[u("routing.step"),u("routing.assigned_to"),u("routing.department"),u("routing.status"),u("routing.start_date"),u("routing.end_date"),u("routing.duration"),u("routing.notes")].forEach(e=>{const t=document.createElement("th");t.textContent=e,o.appendChild(t)}),r.appendChild(o),a.appendChild(r);const s=document.createElement("tbody");e.details.forEach(e=>{const t=document.createElement("tr"),n=document.createElement("td");n.textContent=e.step||"N/A",t.appendChild(n);const a=document.createElement("td");a.textContent=e.assignedTo||"N/A",t.appendChild(a);const r=document.createElement("td");r.textContent=e.department||"N/A",t.appendChild(r);const o=document.createElement("td"),i=document.createElement("span");i.className=`ct-badge ct-status-${(e.status||"").toLowerCase().replace(" ","-")}`,i.textContent=e.status||"N/A",o.appendChild(i),t.appendChild(o);const c=document.createElement("td");c.textContent=e.startDate||"N/A",t.appendChild(c);const d=document.createElement("td");d.textContent=e.endDate||"N/A",t.appendChild(d);const l=document.createElement("td");l.textContent=e.duration||"N/A",t.appendChild(l);const p=document.createElement("td");p.textContent=e.notes||"N/A",p.title=e.notes,t.appendChild(p),s.appendChild(t)}),a.appendChild(s),n.appendChild(a),t.appendChild(n)}else{const e=document.createElement("p");e.textContent=u("routing.no_details_data"),t.appendChild(e)}return t}(n);function L(e){o.querySelectorAll(".ct-btn").forEach(e=>{e.classList.remove("active"),e.classList.add("ct-btn-secondary"),e.classList.remove("ct-btn-primary")});const t="diagram"===e?s:"timeline"===e?i:c;t.classList.add("active"),t.classList.add("ct-btn-primary"),t.classList.remove("ct-btn-secondary");_.querySelectorAll(".ct-routing-view").forEach(e=>e.classList.remove("active"));const n=_.querySelector(`#${e}-view`);n&&n.classList.add("active")}_.appendChild(E),_.appendChild(I),_.appendChild(A),a.appendChild(r),a.appendChild(l),a.appendChild(_),t.appendChild(a)}).catch(()=>{t.innerHTML="";const e=document.createElement("div");e.className="ct-error",e.textContent=u("common.error"),t.appendChild(e)})}function z(){const e=document.getElementById("ct-content");e&&F(e)}function j(e,t){const n=document.getElementById("ct-content");if(n)switch(n.innerHTML="",document.querySelectorAll(".ct-tab-button").forEach(t=>{t.classList.remove("active"),t.dataset.tab===e&&t.classList.add("active")}),e){case"tab-profile":h(n,t);break;case"tab-docs":b(n,t);break;case"tab-users":f(n,t);break;case"tab-refund":L(n,t);break;case"tab-routing":M(n,t);break;default:F(n)}}function F(e){const t=document.createElement("div");t.className="ct-loading",t.textContent=u("loading_my_cases"),e.appendChild(t),i().then(t=>{if(e.innerHTML="",!t||!t.data||0===t.data.length){const t=document.createElement("div");return t.className="ct-no-data",t.textContent=u("cases.no_data"),void e.appendChild(t)}const n=document.createElement("div");n.className="ct-cases-list";const a=document.createElement("h3");a.textContent=u("my_cases"),n.appendChild(a);const r=document.createElement("table");r.className="ct-table ct-cases-table";const o=document.createElement("thead"),s=document.createElement("tr");[u("cases.case_number"),u("cases.status"),u("cases.type"),u("cases.priority"),u("cases.last_update"),u("cases.actions")].forEach(e=>{const t=document.createElement("th");t.textContent=e,s.appendChild(t)}),o.appendChild(s),r.appendChild(o);const i=document.createElement("tbody");t.data.forEach(e=>{const t=document.createElement("tr");t.className="ct-case-row",t.onclick=()=>R(e.id,e.caseNumber);const n=document.createElement("td");n.textContent=e.caseNumber||"N/A",t.appendChild(n);const a=document.createElement("td"),r=document.createElement("span");r.className=`ct-badge ct-status-${(e.status||"").toLowerCase().replace(" ","-")}`,r.textContent=e.status||"N/A",a.appendChild(r),t.appendChild(a);const o=document.createElement("td");o.textContent=e.caseType||"N/A",t.appendChild(o);const s=document.createElement("td"),c=document.createElement("span");c.className=`ct-badge ct-priority-${(e.priority||"").toLowerCase()}`,c.textContent=e.priority||"N/A",s.appendChild(c),t.appendChild(s);const d=document.createElement("td");d.textContent=e.lastUpdate||"N/A",t.appendChild(d);const l=document.createElement("td"),p=document.createElement("button");p.className="ct-btn ct-btn-sm ct-btn-primary",p.textContent=u("cases.select"),p.onclick=t=>{t.stopPropagation(),R(e.id,e.caseNumber)},l.appendChild(p),t.appendChild(l),i.appendChild(t)}),r.appendChild(i),n.appendChild(r),e.appendChild(n)}).catch(()=>{e.innerHTML="";const t=document.createElement("div");t.className="ct-error",t.textContent=u("common.error"),e.appendChild(t)})}function R(t,n){e.set("selectedCaseId",t);const a=document.getElementById("ct-header-title-text"),r=document.getElementById("ct-header-subtitle");a&&(a.textContent=`${u("case")} ${n}`),r&&(r.textContent=u("case_selected_message"));const o=document.getElementById("ct-tab-buttons");o&&(o.style.display="flex"),j("tab-profile",t)}function U(){const t=document.getElementById("coretabs-toggle"),n=document.getElementById("coretabs-sidebar"),r=document.getElementById("coretabs-close");t&&n&&t.addEventListener("click",()=>{n.classList.toggle("open"),n.classList.contains("open")&&z()}),r&&n&&r.addEventListener("click",()=>{n.classList.remove("open")});const o=document.getElementById("ct-language-select");o&&(o.value=e.get("currentLanguage")||"en",o.addEventListener("change",t=>{const n=t.target.value;var r;l[r=n]&&(p=r,localStorage.setItem(a,r)),e.set("currentLanguage",n);const o=document.getElementById("coretabs-sidebar");o&&o.classList.contains("open")&&(O(),z())}));document.querySelectorAll(".ct-tab-button").forEach(t=>{t.addEventListener("click",()=>{j(t.dataset.tab,e.get("selectedCaseId"))})});const s=document.getElementById("ct-nav-back-btn");s&&s.addEventListener("click",()=>{e.set("selectedCaseId",null);const t=document.getElementById("ct-header-title-text"),n=document.getElementById("ct-header-subtitle");t&&(t.textContent=u("no_case_selected")),n&&(n.textContent=u("select_case_message"));const a=document.getElementById("ct-tab-buttons");a&&(a.style.display="none"),s.style.display="none",z()}),document.addEventListener("click",e=>{n&&n.classList.contains("open")&&(n.contains(e.target)||t.contains(e.target)||n.classList.remove("open"))}),document.addEventListener("keydown",e=>{"Escape"===e.key&&n&&n.classList.contains("open")&&n.classList.remove("open"),e.ctrlKey&&e.shiftKey&&"C"===e.key&&(e.preventDefault(),t&&t.click())}),e.subscribe("selectedCaseId",e=>{const t=document.getElementById("ct-nav-back-btn"),n=document.getElementById("ct-tab-buttons");e?(t&&(t.style.display="block"),n&&(n.style.display="flex")):(t&&(t.style.display="none"),n&&(n.style.display="none"))}),e.subscribe("currentLanguage",()=>{O()})}function O(){const t=document.getElementById("ct-nav-title");t&&(t.textContent=u("my_cases"));const n=document.getElementById("ct-nav-back-btn");n&&(n.textContent=u("back"));const a=document.getElementById("ct-header-title-text"),r=document.getElementById("ct-header-subtitle");e.get("selectedCaseId")||(a&&(a.textContent=u("no_case_selected")),r&&(r.textContent=u("select_case_message")));document.querySelectorAll(".ct-tab-button").forEach(e=>{switch(e.dataset.tab){case"tab-profile":e.textContent=u("profile");break;case"tab-docs":e.textContent=u("documents");break;case"tab-users":e.textContent=u("users");break;case"tab-refund":e.textContent=u("refund_review");break;case"tab-routing":e.textContent=u("routing")}})}function B(){const e=document.getElementById("coretabs-toggle");e&&e.remove();const t=document.createElement("button");return t.id="coretabs-toggle",t.className="coretabs-toggle",t.textContent=u("coretabs"),t.setAttribute("aria-label",u("app.toggle")),document.body.appendChild(t),t}const H=document.createElement("style");H.textContent=":root {\r\n  --primary-color: #1976d2;\r\n  --secondary-color: #424242;\r\n  --success-color: #4caf50;\r\n  --warning-color: #ff9800;\r\n  --error-color: #f44336;\r\n  --info-color: #2196f3;\r\n  \r\n  --text-primary: #212121;\r\n  --text-secondary: #757575;\r\n  --text-disabled: #bdbdbd;\r\n  \r\n  --background-primary: #ffffff;\r\n  --background-secondary: #f5f5f5;\r\n  --background-paper: #ffffff;\r\n  \r\n  --border-color: #e0e0e0;\r\n  --divider-color: #e0e0e0;\r\n  \r\n  --shadow-1: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);\r\n  --shadow-2: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);\r\n  --shadow-3: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23);\r\n  \r\n  --border-radius: 4px;\r\n  --border-radius-large: 8px;\r\n  \r\n  --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\r\n  --font-size-small: 12px;\r\n  --font-size-normal: 14px;\r\n  --font-size-large: 16px;\r\n  --font-size-xlarge: 18px;\r\n  \r\n  --spacing-xs: 4px;\r\n  --spacing-sm: 8px;\r\n  --spacing-md: 16px;\r\n  --spacing-lg: 24px;\r\n  --spacing-xl: 32px;\r\n  \r\n  --transition-fast: 0.15s ease;\r\n  --transition-normal: 0.3s ease;\r\n  --transition-slow: 0.5s ease;\r\n}";document.head.querySelector("style[data-userscript]")||(H.setAttribute("data-userscript","true"),document.head.appendChild(H));const K=document.createElement("style");K.textContent="/* CoreTabs Styles */\r\n.coretabs-sidebar {\r\n  position: fixed;\r\n  top: 0;\r\n  right: -400px;\r\n  width: 400px;\r\n  height: 100vh;\r\n  background: var(--background-paper);\r\n  box-shadow: var(--shadow-3);\r\n  z-index: 10000;\r\n  transition: right var(--transition-normal);\r\n  font-family: var(--font-family);\r\n  font-size: var(--font-size-normal);\r\n  overflow: hidden;\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.coretabs-sidebar.open {\r\n  right: 0;\r\n}\r\n\r\n.coretabs-header {\r\n  background: var(--primary-color);\r\n  color: white;\r\n  padding: var(--spacing-md);\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  flex-shrink: 0;\r\n}\r\n\r\n.coretabs-title {\r\n  font-size: var(--font-size-large);\r\n  font-weight: 600;\r\n  margin: 0;\r\n}\r\n\r\n.coretabs-close {\r\n  background: none;\r\n  border: none;\r\n  color: white;\r\n  font-size: var(--font-size-xlarge);\r\n  cursor: pointer;\r\n  padding: var(--spacing-xs);\r\n  border-radius: var(--border-radius);\r\n  transition: background-color var(--transition-fast);\r\n}\r\n\r\n.coretabs-close:hover {\r\n  background-color: rgba(255, 255, 255, 0.1);\r\n}\r\n\r\n.coretabs-content {\r\n  flex: 1;\r\n  overflow-y: auto;\r\n  padding: var(--spacing-md);\r\n}\r\n\r\n.coretabs-profile {\r\n  background: var(--background-secondary);\r\n  padding: var(--spacing-md);\r\n  border-radius: var(--border-radius);\r\n  margin-bottom: var(--spacing-md);\r\n}\r\n\r\n.coretabs-profile-name {\r\n  font-weight: 600;\r\n  color: var(--text-primary);\r\n  margin-bottom: var(--spacing-xs);\r\n}\r\n\r\n.coretabs-profile-role {\r\n  color: var(--text-secondary);\r\n  font-size: var(--font-size-small);\r\n}\r\n\r\n.coretabs-tabs {\r\n  display: flex;\r\n  border-bottom: 1px solid var(--border-color);\r\n  margin-bottom: var(--spacing-md);\r\n}\r\n\r\n.coretabs-tab {\r\n  background: none;\r\n  border: none;\r\n  padding: var(--spacing-sm) var(--spacing-md);\r\n  cursor: pointer;\r\n  border-bottom: 2px solid transparent;\r\n  transition: all var(--transition-fast);\r\n  color: var(--text-secondary);\r\n  font-size: var(--font-size-normal);\r\n}\r\n\r\n.coretabs-tab.active {\r\n  color: var(--primary-color);\r\n  border-bottom-color: var(--primary-color);\r\n}\r\n\r\n.coretabs-tab:hover {\r\n  background-color: var(--background-secondary);\r\n}\r\n\r\n.coretabs-tab-content {\r\n  display: none;\r\n}\r\n\r\n.coretabs-tab-content.active {\r\n  display: block;\r\n}\r\n\r\n.coretabs-loading {\r\n  text-align: center;\r\n  padding: var(--spacing-lg);\r\n  color: var(--text-secondary);\r\n}\r\n\r\n.coretabs-error {\r\n  background: #ffebee;\r\n  color: var(--error-color);\r\n  padding: var(--spacing-md);\r\n  border-radius: var(--border-radius);\r\n  margin-bottom: var(--spacing-md);\r\n  border-left: 4px solid var(--error-color);\r\n}\r\n\r\n.coretabs-toggle {\r\n  position: fixed;\r\n  top: 20px;\r\n  right: 20px;\r\n  background: var(--primary-color);\r\n  color: white;\r\n  border: none;\r\n  width: 50px;\r\n  height: 50px;\r\n  border-radius: 50%;\r\n  cursor: pointer;\r\n  box-shadow: var(--shadow-2);\r\n  z-index: 9999;\r\n  font-size: var(--font-size-large);\r\n  transition: all var(--transition-fast);\r\n}\r\n\r\n.coretabs-toggle:hover {\r\n  transform: scale(1.1);\r\n  box-shadow: var(--shadow-3);\r\n}\r\n\r\n.coretabs-table {\r\n  width: 100%;\r\n  border-collapse: collapse;\r\n  margin-bottom: var(--spacing-md);\r\n}\r\n\r\n.coretabs-table th,\r\n.coretabs-table td {\r\n  padding: var(--spacing-sm);\r\n  text-align: left;\r\n  border-bottom: 1px solid var(--border-color);\r\n  font-size: var(--font-size-small);\r\n}\r\n\r\n.coretabs-table th {\r\n  background: var(--background-secondary);\r\n  font-weight: 600;\r\n  color: var(--text-primary);\r\n}\r\n\r\n.coretabs-table tr:hover {\r\n  background: var(--background-secondary);\r\n}\r\n\r\n.coretabs-badge {\r\n  display: inline-block;\r\n  padding: 2px 8px;\r\n  border-radius: 12px;\r\n  font-size: 11px;\r\n  font-weight: 500;\r\n  text-transform: uppercase;\r\n}\r\n\r\n.coretabs-badge.status-active {\r\n  background: #e8f5e8;\r\n  color: var(--success-color);\r\n}\r\n\r\n.coretabs-badge.status-pending {\r\n  background: #fff3e0;\r\n  color: var(--warning-color);\r\n}\r\n\r\n.coretabs-badge.status-completed {\r\n  background: #e3f2fd;\r\n  color: var(--info-color);\r\n}";document.head.querySelector("style[data-userscript]")||(K.setAttribute("data-userscript","true"),document.head.appendChild(K));const V=document.createElement("style");V.textContent="/* Responsive styles */\r\n@media (max-width: 768px) {\r\n  .coretabs-sidebar {\r\n    width: 100vw;\r\n    right: -100vw;\r\n  }\r\n  \r\n  .coretabs-sidebar.open {\r\n    right: 0;\r\n  }\r\n  \r\n  .coretabs-toggle {\r\n    top: 10px;\r\n    right: 10px;\r\n    width: 40px;\r\n    height: 40px;\r\n    font-size: var(--font-size-normal);\r\n  }\r\n  \r\n  .coretabs-content {\r\n    padding: var(--spacing-sm);\r\n  }\r\n  \r\n  .coretabs-table {\r\n    font-size: 11px;\r\n  }\r\n  \r\n  .coretabs-table th,\r\n  .coretabs-table td {\r\n    padding: var(--spacing-xs);\r\n  }\r\n}\r\n\r\n@media (max-width: 480px) {\r\n  .coretabs-header {\r\n    padding: var(--spacing-sm);\r\n  }\r\n  \r\n  .coretabs-title {\r\n    font-size: var(--font-size-normal);\r\n  }\r\n  \r\n  .coretabs-tabs {\r\n    flex-wrap: wrap;\r\n  }\r\n  \r\n  .coretabs-tab {\r\n    flex: 1;\r\n    min-width: 80px;\r\n    padding: var(--spacing-xs) var(--spacing-sm);\r\n    font-size: var(--font-size-small);\r\n  }\r\n}";document.head.querySelector("style[data-userscript]")||(V.setAttribute("data-userscript","true"),document.head.appendChild(V));const W="undefined"!=typeof __VERSION__?__VERSION__:"1.0.0";class q{constructor(){this.initialized=!1,this.version=W,this.updateChecker=new m,this.injectStyles()}injectStyles(){if(document.querySelector("style[data-coretabs]"))return;const e=document.createElement("style");e.setAttribute("data-coretabs","true"),e.textContent=":root {\r\n  --primary-color: #1976d2;\r\n  --secondary-color: #424242;\r\n  --success-color: #4caf50;\r\n  --warning-color: #ff9800;\r\n  --error-color: #f44336;\r\n  --info-color: #2196f3;\r\n  \r\n  --text-primary: #212121;\r\n  --text-secondary: #757575;\r\n  --text-disabled: #bdbdbd;\r\n  \r\n  --background-primary: #ffffff;\r\n  --background-secondary: #f5f5f5;\r\n  --background-paper: #ffffff;\r\n  \r\n  --border-color: #e0e0e0;\r\n  --divider-color: #e0e0e0;\r\n  \r\n  --shadow-1: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);\r\n  --shadow-2: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);\r\n  --shadow-3: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23);\r\n  \r\n  --border-radius: 4px;\r\n  --border-radius-large: 8px;\r\n  \r\n  --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\r\n  --font-size-small: 12px;\r\n  --font-size-normal: 14px;\r\n  --font-size-large: 16px;\r\n  --font-size-xlarge: 18px;\r\n  \r\n  --spacing-xs: 4px;\r\n  --spacing-sm: 8px;\r\n  --spacing-md: 16px;\r\n  --spacing-lg: 24px;\r\n  --spacing-xl: 32px;\r\n  \r\n  --transition-fast: 0.15s ease;\r\n  --transition-normal: 0.3s ease;\r\n  --transition-slow: 0.5s ease;\r\n}/* CoreTabs Styles */\r\n.coretabs-sidebar {\r\n  position: fixed;\r\n  top: 0;\r\n  right: -400px;\r\n  width: 400px;\r\n  height: 100vh;\r\n  background: var(--background-paper);\r\n  box-shadow: var(--shadow-3);\r\n  z-index: 10000;\r\n  transition: right var(--transition-normal);\r\n  font-family: var(--font-family);\r\n  font-size: var(--font-size-normal);\r\n  overflow: hidden;\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.coretabs-sidebar.open {\r\n  right: 0;\r\n}\r\n\r\n.coretabs-header {\r\n  background: var(--primary-color);\r\n  color: white;\r\n  padding: var(--spacing-md);\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  flex-shrink: 0;\r\n}\r\n\r\n.coretabs-title {\r\n  font-size: var(--font-size-large);\r\n  font-weight: 600;\r\n  margin: 0;\r\n}\r\n\r\n.coretabs-close {\r\n  background: none;\r\n  border: none;\r\n  color: white;\r\n  font-size: var(--font-size-xlarge);\r\n  cursor: pointer;\r\n  padding: var(--spacing-xs);\r\n  border-radius: var(--border-radius);\r\n  transition: background-color var(--transition-fast);\r\n}\r\n\r\n.coretabs-close:hover {\r\n  background-color: rgba(255, 255, 255, 0.1);\r\n}\r\n\r\n.coretabs-content {\r\n  flex: 1;\r\n  overflow-y: auto;\r\n  padding: var(--spacing-md);\r\n}\r\n\r\n.coretabs-profile {\r\n  background: var(--background-secondary);\r\n  padding: var(--spacing-md);\r\n  border-radius: var(--border-radius);\r\n  margin-bottom: var(--spacing-md);\r\n}\r\n\r\n.coretabs-profile-name {\r\n  font-weight: 600;\r\n  color: var(--text-primary);\r\n  margin-bottom: var(--spacing-xs);\r\n}\r\n\r\n.coretabs-profile-role {\r\n  color: var(--text-secondary);\r\n  font-size: var(--font-size-small);\r\n}\r\n\r\n.coretabs-tabs {\r\n  display: flex;\r\n  border-bottom: 1px solid var(--border-color);\r\n  margin-bottom: var(--spacing-md);\r\n}\r\n\r\n.coretabs-tab {\r\n  background: none;\r\n  border: none;\r\n  padding: var(--spacing-sm) var(--spacing-md);\r\n  cursor: pointer;\r\n  border-bottom: 2px solid transparent;\r\n  transition: all var(--transition-fast);\r\n  color: var(--text-secondary);\r\n  font-size: var(--font-size-normal);\r\n}\r\n\r\n.coretabs-tab.active {\r\n  color: var(--primary-color);\r\n  border-bottom-color: var(--primary-color);\r\n}\r\n\r\n.coretabs-tab:hover {\r\n  background-color: var(--background-secondary);\r\n}\r\n\r\n.coretabs-tab-content {\r\n  display: none;\r\n}\r\n\r\n.coretabs-tab-content.active {\r\n  display: block;\r\n}\r\n\r\n.coretabs-loading {\r\n  text-align: center;\r\n  padding: var(--spacing-lg);\r\n  color: var(--text-secondary);\r\n}\r\n\r\n.coretabs-error {\r\n  background: #ffebee;\r\n  color: var(--error-color);\r\n  padding: var(--spacing-md);\r\n  border-radius: var(--border-radius);\r\n  margin-bottom: var(--spacing-md);\r\n  border-left: 4px solid var(--error-color);\r\n}\r\n\r\n.coretabs-toggle {\r\n  position: fixed;\r\n  top: 20px;\r\n  right: 20px;\r\n  background: var(--primary-color);\r\n  color: white;\r\n  border: none;\r\n  width: 50px;\r\n  height: 50px;\r\n  border-radius: 50%;\r\n  cursor: pointer;\r\n  box-shadow: var(--shadow-2);\r\n  z-index: 9999;\r\n  font-size: var(--font-size-large);\r\n  transition: all var(--transition-fast);\r\n}\r\n\r\n.coretabs-toggle:hover {\r\n  transform: scale(1.1);\r\n  box-shadow: var(--shadow-3);\r\n}\r\n\r\n.coretabs-table {\r\n  width: 100%;\r\n  border-collapse: collapse;\r\n  margin-bottom: var(--spacing-md);\r\n}\r\n\r\n.coretabs-table th,\r\n.coretabs-table td {\r\n  padding: var(--spacing-sm);\r\n  text-align: left;\r\n  border-bottom: 1px solid var(--border-color);\r\n  font-size: var(--font-size-small);\r\n}\r\n\r\n.coretabs-table th {\r\n  background: var(--background-secondary);\r\n  font-weight: 600;\r\n  color: var(--text-primary);\r\n}\r\n\r\n.coretabs-table tr:hover {\r\n  background: var(--background-secondary);\r\n}\r\n\r\n.coretabs-badge {\r\n  display: inline-block;\r\n  padding: 2px 8px;\r\n  border-radius: 12px;\r\n  font-size: 11px;\r\n  font-weight: 500;\r\n  text-transform: uppercase;\r\n}\r\n\r\n.coretabs-badge.status-active {\r\n  background: #e8f5e8;\r\n  color: var(--success-color);\r\n}\r\n\r\n.coretabs-badge.status-pending {\r\n  background: #fff3e0;\r\n  color: var(--warning-color);\r\n}\r\n\r\n.coretabs-badge.status-completed {\r\n  background: #e3f2fd;\r\n  color: var(--info-color);\r\n}/* Responsive styles */\r\n@media (max-width: 768px) {\r\n  .coretabs-sidebar {\r\n    width: 100vw;\r\n    right: -100vw;\r\n  }\r\n  \r\n  .coretabs-sidebar.open {\r\n    right: 0;\r\n  }\r\n  \r\n  .coretabs-toggle {\r\n    top: 10px;\r\n    right: 10px;\r\n    width: 40px;\r\n    height: 40px;\r\n    font-size: var(--font-size-normal);\r\n  }\r\n  \r\n  .coretabs-content {\r\n    padding: var(--spacing-sm);\r\n  }\r\n  \r\n  .coretabs-table {\r\n    font-size: 11px;\r\n  }\r\n  \r\n  .coretabs-table th,\r\n  .coretabs-table td {\r\n    padding: var(--spacing-xs);\r\n  }\r\n}\r\n\r\n@media (max-width: 480px) {\r\n  .coretabs-header {\r\n    padding: var(--spacing-sm);\r\n  }\r\n  \r\n  .coretabs-title {\r\n    font-size: var(--font-size-normal);\r\n  }\r\n  \r\n  .coretabs-tabs {\r\n    flex-wrap: wrap;\r\n  }\r\n  \r\n  .coretabs-tab {\r\n    flex: 1;\r\n    min-width: 80px;\r\n    padding: var(--spacing-xs) var(--spacing-sm);\r\n    font-size: var(--font-size-small);\r\n  }\r\n}",document.head.appendChild(e)}async init(){if(!this.initialized)try{this.initializeState(),this.createUI(),this.initializeEventHandlers(),await this.fetchInitialData(),this.initialized=!0}catch(e){}}createUI(){B(),function(){const e=document.getElementById("coretabs-sidebar");e&&e.remove(),B();const t=document.createElement("div");t.id="coretabs-sidebar",t.className="coretabs-sidebar";const n=document.createElement("div");n.className="coretabs-header",n.id="ct-header";const a=document.createElement("div");a.className="ct-nav",a.id="ct-nav";const r=document.createElement("button");r.id="ct-nav-back-btn",r.className="ct-nav-back-btn",r.textContent=u("back"),r.style.display="none";const o=document.createElement("h2");o.id="ct-nav-title",o.className="ct-nav-title",o.textContent=u("my_cases");const s=document.createElement("select");s.id="ct-language-select",s.className="ct-language-select";const i=document.createElement("option");i.value="en",i.textContent="English";const c=document.createElement("option");c.value="id",c.textContent="Bahasa Indonesia",s.appendChild(i),s.appendChild(c),a.appendChild(r),a.appendChild(o),a.appendChild(s);const d=document.createElement("div");d.className="ct-header-title",d.id="ct-header-title";const l=document.createElement("h3");l.id="ct-header-title-text",l.textContent=u("no_case_selected");const p=document.createElement("p");p.id="ct-header-subtitle",p.textContent=u("select_case_message"),d.appendChild(l),d.appendChild(p);const m=document.createElement("div");m.className="ct-tab-buttons",m.id="ct-tab-buttons",[{id:"tab-profile",key:"profile"},{id:"tab-docs",key:"documents"},{id:"tab-users",key:"users"},{id:"tab-refund",key:"refund_review"},{id:"tab-routing",key:"routing"}].forEach(e=>{const t=document.createElement("button");t.className="ct-tab-button",t.dataset.tab=e.id,t.textContent=u(e.key),m.appendChild(t)}),n.appendChild(a),n.appendChild(d),n.appendChild(m);const h=document.createElement("div");h.className="ct-content",h.id="ct-content";const g=document.createElement("div");g.className="ct-loading-message",g.textContent=u("loading_my_cases"),h.appendChild(g),t.appendChild(n),t.appendChild(h),document.body.appendChild(t)}()}initializeEventHandlers(){U()}initializeState(){e.set("currentScreen","cases"),e.set("currentTab","profile"),e.set("sidebarOpen",!1),e.set("selectedCaseId",null),e.set("currentLanguage","en"),e.set("allMyCases",[]),e.set("allCaseDocuments",[]),e.set("allCaseUsers",[]),e.set("refundReviewData",[]),e.set("filteredRefundData",[]),e.set("routingData",null),e.set("workflowDiagram",null),e.set("loadedCasesForCaseId",null),e.set("loadedDocumentsForCaseId",null),e.set("loadedUsersForCaseId",null),e.set("loadedRefundForCaseId",null),e.set("loadedRoutingForCaseId",null)}async fetchInitialData(){try{const t=await i();t&&t.data&&e.set("allMyCases",t.data)}catch(e){}}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{(new q).init()}):(new q).init()})();